// @/lib/pricing-data.ts

export interface PricingRow {
  vehicles: number;
  "1 месяц": number;
  "3 месяца": number;
  "6 месяцев": number;
  "12 месяцев": number;
}

export const PRICING_DATA: PricingRow[] = [
  {
    vehicles: 1,
    "1 месяц": 2700,
    "3 месяца": 2430,
    "6 месяцев": 2295,
    "12 месяцев": 2160,
  },
  {
    vehicles: 2,
    "1 месяц": 4800,
    "3 месяца": 4320,
    "6 месяцев": 4080,
    "12 месяцев": 3840,
  },
  {
    vehicles: 3,
    "1 месяц": 7200,
    "3 месяца": 6480,
    "6 месяцев": 6120,
    "12 месяцев": 5760,
  },
  {
    vehicles: 4,
    "1 месяц": 8640,
    "3 месяца": 7776,
    "6 месяцев": 7344,
    "12 месяцев": 6912,
  },
  {
    vehicles: 5,
    "1 месяц": 10800,
    "3 месяца": 9720,
    "6 месяцев": 9180,
    "12 месяцев": 8640,
  },
  {
    vehicles: 6,
    "1 месяц": 12960,
    "3 месяца": 11664,
    "6 месяцев": 11016,
    "12 месяцев": 10368,
  },
  {
    vehicles: 7,
    "1 месяц": 13440,
    "3 месяца": 12096,
    "6 месяцев": 11424,
    "12 месяцев": 10752,
  },
  {
    vehicles: 8,
    "1 месяц": 15360,
    "3 месяца": 13824,
    "6 месяцев": 13056,
    "12 месяцев": 12288,
  },
  {
    vehicles: 9,
    "1 месяц": 15600,
    "3 месяца": 14040,
    "6 месяцев": 13260,
    "12 месяцев": 12480,
  },
  {
    vehicles: 10,
    "1 месяц": 15840,
    "3 месяца": 14256,
    "6 месяцев": 13464,
    "12 месяцев": 12672,
  },
  {
    vehicles: 11,
    "1 месяц": 16080,
    "3 месяца": 14472,
    "6 месяцев": 13668,
    "12 месяцев": 12864,
  },
  {
    vehicles: 12,
    "1 месяц": 16320,
    "3 месяца": 14688,
    "6 месяцев": 13872,
    "12 месяцев": 13056,
  },
  {
    vehicles: 13,
    "1 месяц": 16560,
    "3 месяца": 14904,
    "6 месяцев": 14076,
    "12 месяцев": 13248,
  },
  {
    vehicles: 14,
    "1 месяц": 16800,
    "3 месяца": 15120,
    "6 месяцев": 14280,
    "12 месяцев": 13440,
  },
  {
    vehicles: 15,
    "1 месяц": 17040,
    "3 месяца": 15336,
    "6 месяцев": 14484,
    "12 месяцев": 13632,
  },
  {
    vehicles: 16,
    "1 месяц": 17280,
    "3 месяца": 15552,
    "6 месяцев": 14688,
    "12 месяцев": 13824,
  },
  {
    vehicles: 17,
    "1 месяц": 17520,
    "3 месяца": 15768,
    "6 месяцев": 14892,
    "12 месяцев": 14016,
  },
  {
    vehicles: 18,
    "1 месяц": 17760,
    "3 месяца": 15984,
    "6 месяцев": 15096,
    "12 месяцев": 14208,
  },
  {
    vehicles: 19,
    "1 месяц": 18000,
    "3 месяца": 16200,
    "6 месяцев": 15300,
    "12 месяцев": 14400,
  },
  {
    vehicles: 20,
    "1 месяц": 18240,
    "3 месяца": 16416,
    "6 месяцев": 15504,
    "12 месяцев": 14592,
  },
  {
    vehicles: 25,
    "1 месяц": 19440,
    "3 месяца": 17496,
    "6 месяцев": 16524,
    "12 месяцев": 15552,
  },
  {
    vehicles: 30,
    "1 месяц": 20640,
    "3 месяца": 18576,
    "6 месяцев": 17544,
    "12 месяцев": 16512,
  },
  {
    vehicles: 35,
    "1 месяц": 21840,
    "3 месяца": 19656,
    "6 месяцев": 18564,
    "12 месяцев": 17472,
  },
  {
    vehicles: 40,
    "1 месяц": 23040,
    "3 месяца": 20736,
    "6 месяцев": 19584,
    "12 месяцев": 18432,
  },
  {
    vehicles: 45,
    "1 месяц": 24240,
    "3 месяца": 21816,
    "6 месяцев": 20604,
    "12 месяцев": 19392,
  },
  {
    vehicles: 50,
    "1 месяц": 25440,
    "3 месяца": 22896,
    "6 месяцев": 21624,
    "12 месяцев": 20352,
  },
  {
    vehicles: 60,
    "1 месяц": 27840,
    "3 месяца": 25056,
    "6 месяцев": 23664,
    "12 месяцев": 22272,
  },
  {
    vehicles: 70,
    "1 месяц": 30240,
    "3 месяца": 27216,
    "6 месяцев": 25704,
    "12 месяцев": 24192,
  },
  {
    vehicles: 80,
    "1 месяц": 32640,
    "3 месяца": 29376,
    "6 месяцев": 27744,
    "12 месяцев": 26112,
  },
  {
    vehicles: 90,
    "1 месяц": 35040,
    "3 месяца": 31536,
    "6 месяцев": 29784,
    "12 месяцев": 28032,
  },
  {
    vehicles: 100,
    "1 месяц": 37440,
    "3 месяца": 33696,
    "6 месяцев": 31824,
    "12 месяцев": 29952,
  },
];

// Функция для поиска точной цены или интерполяции
export function calculatePrice(vehicleCount: number, period: string): number {
  const periodKey = period as keyof PricingRow;

  // Проверяем, есть ли точное совпадение
  const exactMatch = PRICING_DATA.find((row) => row.vehicles === vehicleCount);
  if (exactMatch && exactMatch[periodKey]) {
    return exactMatch[periodKey] as number;
  }

  // Если точного совпадения нет, выполняем линейную интерполяцию
  const sortedData = PRICING_DATA.sort((a, b) => a.vehicles - b.vehicles);

  // Находим ближайшие значения снизу и сверху
  let lower = sortedData[0];
  let upper = sortedData[sortedData.length - 1];

  for (let i = 0; i < sortedData.length - 1; i++) {
    if (
      sortedData[i].vehicles <= vehicleCount &&
      sortedData[i + 1].vehicles >= vehicleCount
    ) {
      lower = sortedData[i];
      upper = sortedData[i + 1];
      break;
    }
  }

  // Если количество автомобилей меньше минимального в таблице
  if (vehicleCount < sortedData[0].vehicles) {
    const rate = (sortedData[0][periodKey] as number) / sortedData[0].vehicles;
    return Math.round(rate * vehicleCount);
  }

  // Если количество автомобилей больше максимального в таблице
  if (vehicleCount > sortedData[sortedData.length - 1].vehicles) {
    const lastRow = sortedData[sortedData.length - 1];
    const rate = (lastRow[periodKey] as number) / lastRow.vehicles;
    return Math.round(rate * vehicleCount);
  }

  // Линейная интерполяция
  const lowerPrice = lower[periodKey] as number;
  const upperPrice = upper[periodKey] as number;
  const ratio =
    (vehicleCount - lower.vehicles) / (upper.vehicles - lower.vehicles);

  return Math.round(lowerPrice + ratio * (upperPrice - lowerPrice));
}

// Функция для расчета экономии (сравнение с 1 месяцем)
export function calculateSavings(
  vehicleCount: number,
  period: string
): {
  monthlyPrice: number;
  selectedPrice: number;
  savings: number;
  savingsPercent: number;
  totalSavings: number;
} {
  const monthlyPrice = calculatePrice(vehicleCount, "1 месяц");
  const selectedPrice = calculatePrice(vehicleCount, period);

  // Определяем количество месяцев в периоде
  const periodMonths =
    {
      "1 месяц": 1,
      "3 месяца": 3,
      "6 месяцев": 6,
      "12 месяцев": 12,
    }[period] || 1;

  const totalMonthlyPrice = monthlyPrice * periodMonths;
  const totalSavings = totalMonthlyPrice - selectedPrice;
  const savingsPercent =
    totalSavings > 0 ? Math.round((totalSavings / totalMonthlyPrice) * 100) : 0;

  return {
    monthlyPrice,
    selectedPrice,
    savings: totalSavings,
    savingsPercent,
    totalSavings,
  };
}

export type PeriodType = "1 месяц" | "3 месяца" | "6 месяцев" | "12 месяцев";
export const PERIODS: PeriodType[] = [
  "1 месяц",
  "3 месяца",
  "6 месяцев",
  "12 месяцев",
];
export const VEHICLE_OPTIONS = [
  "1 авто",
  "10 авто",
  "50 авто",
  "100 авто",
  "другое",
];
